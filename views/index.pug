extends template.pug
block content
  #content
    h1#choose-text(style='padding-bottom: 0px; margin-bottom: 0px;')= choose
    h2#username-text(style='padding-left: 25vw; padding-top: 0px; margin-top: 0px; margin-bottom: 0px;')= username
    p#errorMessage(style='color: red; font-size: 2vw;')
    input#username(type='text', name='username', autocomplete="off", maxlength='15', pattern=".{3,15}", title="3 to 15 characters", required)
    br
    #div-start(style='padding-left: 10vw; height: 1.5em;')
      button#start(type='button')= start
  script.
    var $start = $('#start');
    var $username = $('#username');
    var $errorMessage = $('#errorMessage');
    
    // Function called when lobby is ready to load
    function onLobyStart() {
      var modal = $('#room-create');
      var create = $('#create');
      create.click(function () {
        modal.css({"display": "block"});
      });
      var cancel = $('#cancel');
      cancel.click(function() {
        modal.css({"display": "none"});
        $('#room-name').val('');
      });
    }
    
    $start.click(function() {
      usernameLength = $username.val().length;
      if (usernameLength < 3 || usernameLength > 15)
        $errorMessage.text('Username must contain 3 to 15 characters');
      else
        socket.emit('login-request', {username: $username.val()});
    });
    
    var socket = io.connect('http://localhost:3000');
    
    socket.on('login-aproved', function(data) {
      socket.id = data.id;
      var page = $(data.page);
      var content = $.grep(page, function(e) {
        return e.id == 'content'; 
      });
      $('#content').html(content);
      onLobyStart();
    });
    
    socket.on('login-declined', function(data) {
      var errorMessage = data.errorMessage;
      $errorMessage.text(errorMessage);
    });
